# .github/workflows/release-builder.yml

# Nome do Workflow: Aparecer√° no separador "Actions" do seu reposit√≥rio no GitHub.
name: Build Android Release APK

# Gatilho (Trigger): Define quando este workflow deve ser executado.
on:
  push:
    tags:
      - 'v*.*.*' # Executa sempre que uma tag que come√ßa com 'v' (ex: v1.0.0, v1.2.3) √© enviada para o reposit√≥rio.

# Trabalhos (Jobs): Define uma sequ√™ncia de tarefas a serem executadas.
jobs:
  build-android:
    # Nome do trabalho: Aparecer√° na interface do GitHub Actions.
    name: Build Flutter App for Android

    # M√°quina Virtual: Especifica o tipo de m√°quina que o GitHub deve usar para executar o trabalho.
    # 'ubuntu-latest' √© a escolha padr√£o e recomendada para builds Android.
    runs-on: ubuntu-latest

    # Passos (Steps): A sequ√™ncia de a√ß√µes que comp√µem o trabalho.
    steps:
      # 1. Checkout do C√≥digo
      # Baixa o c√≥digo do seu reposit√≥rio para a m√°quina virtual.
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configurar o Java (JDK)
      # O Flutter para Android depende do Java Development Kit.
      # A vers√£o 17 √© uma escolha segura e moderna para builds Android atuais.
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. Configurar o Flutter SDK
      # Baixa e instala a vers√£o especificada do Flutter na m√°quina virtual.
      # √â uma boa pr√°tica fixar a vers√£o para garantir builds consistentes.
      # Verifique a sua vers√£o local com `flutter --version` e use-a aqui.
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.35.5' # Substitua pela sua vers√£o do Flutter, se for diferente.
          channel: 'stable'
          cache: true # Ativa o cache para acelerar builds futuros.

      # 4. Instalar Depend√™ncias do Projeto
      # Executa `flutter pub get` para baixar todos os pacotes listados no pubspec.yaml.
      - name: Install dependencies
        run: flutter pub get

      # 5. Limpar o Projeto (Boa Pr√°tica)
      # Executa `flutter clean` para garantir que n√£o h√° artefactos de builds anteriores.
      - name: Clean project
        run: flutter clean

      # 6. Compilar o APK de Release
      # O comando principal que compila a aplica√ß√£o em modo de produ√ß√£o.
      - name: Build APK
        run: flutter build apk --release

      # 7. Renomear o APK (Opcional, mas recomendado)
      # Renomeia o `app-release.apk` para um nome mais descritivo, incluindo a vers√£o da tag.
      # `${{ github.ref_name }}` √© uma vari√°vel do GitHub que cont√©m o nome da tag (ex: "v1.0.0").
      - name: Rename APK
        run: mv build/app/outputs/flutter-apk/app-release.apk CajuScan-${{ github.ref_name }}.apk

      # 8. Fazer Upload do APK para a Release
      # Esta a√ß√£o faz o upload do APK compilado e anexa-o √† p√°gina da Release no GitHub.
      - name: Upload APK to Release
        uses: softprops/action-gh-release@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # O nome do ficheiro que ser√° anexado √† release.
          files: CajuScan-${{ github.ref_name }}.apk
          body: |
            üöÄ Nova vers√£o publicada automaticamente!
            - Compila√ß√£o Android de produ√ß√£o.