# .github/workflows/release-builder.yml

# Nome do Workflow: Aparecerá no separador "Actions" do seu repositório no GitHub.
name: Build Android Release APK

# Gatilho (Trigger): Define quando este workflow deve ser executado.
on:
  push:
    tags:
      - 'v*.*.*' # Executa sempre que uma tag que começa com 'v' (ex: v1.0.0, v1.2.3) é enviada para o repositório.

# --- A CORREÇÃO ESTÁ AQUI ---
# Concede permissões de escrita ao token do workflow.
# Isto é necessário para que a ação 'action-gh-release' possa criar uma release e fazer upload de ficheiros.
permissions:
  contents: write

# Trabalhos (Jobs): Define uma sequência de tarefas a serem executadas.
jobs:
  build-android:
    # Nome do trabalho: Aparecerá na interface do GitHub Actions.
    name: Build Flutter App for Android

    # Máquina Virtual: Especifica o tipo de máquina que o GitHub deve usar para executar o trabalho.
    runs-on: ubuntu-latest

    # Passos (Steps): A sequência de ações que compõem o trabalho.
    steps:
      # 1. Checkout do Código
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configurar o Java (JDK)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. Configurar o Flutter SDK
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.23.0' # Certifique-se que esta é a sua versão correta
          channel: 'stable'
          cache: true

      # 4. Instalar Dependências do Projeto
      - name: Install dependencies
        run: flutter pub get

      # 5. Limpar o Projeto (Boa Prática)
      - name: Clean project
        run: flutter clean

      # 6. Compilar o APK de Release
      - name: Build APK
        run: flutter build apk --release

      # 7. Renomear o APK
      - name: Rename APK
        run: mv build/app/outputs/flutter-apk/app-release.apk CajuScan-${{ github.ref_name }}.apk

      # 8. Fazer Upload do APK para a Release
      - name: Upload APK to Release
        uses: softprops/action-gh-release@v2
        with:
          files: CajuScan-${{ github.ref_name }}.apk

